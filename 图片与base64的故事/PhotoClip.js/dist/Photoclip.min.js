/*!
 * PhotoClip - 一款手势驱动的裁图插件
 * @version v3.3.8
 * @author baijunjie
 * @license MIT
 * 
 * git - https://github.com/baijunjie/PhotoClip.git
 */
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i(require("lrz"),require("iscroll/build/iscroll-zoom"),require("hammerjs")):"function"==typeof define&&define.amd?define(["lrz","iscroll","hammerjs"],i):"object"==typeof exports?exports.PhotoClip=i(require("lrz"),require("iscroll/build/iscroll-zoom"),require("hammerjs")):t.PhotoClip=i(t.lrz,t.IScroll,t.Hammer)}(window,function(t,i,e){return function(t){var i={};function e(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(o,r,function(i){return t[i]}.bind(null,r));return o},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=4)}([function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t){return t/180*Math.PI}i.destroy=function(t){Object.getOwnPropertyNames(t).forEach(function(i){delete t[i]}),t.__proto__=Object.prototype},i.bind=function(t){for(var i=arguments.length,e=Array(i>1?i-1:0),o=1;o<i;o++)e[o-1]=arguments[o];e.forEach(function(i){t[i]=t[i].bind(t)})},i.getScale=function(t,i,e,o){var r=t/e,n=i/o;return r>n?r:n},i.pointRotate=function(t,i){var e=r(i),o=Math.sin(e),n=Math.cos(e);return{x:n*t.x-o*t.y,y:n*t.y+o*t.x}},i.angleToRadian=r,i.loaclToLoacl=function(t,i,e,o){e=e||0,o=o||0;var r=void 0,n=void 0;return s([t,i],function(){r=t.getBoundingClientRect(),n=i.getBoundingClientRect()}),{x:n.left-r.left+e,y:n.top-r.top+o}},i.globalToLoacl=function(t,i,e){i=i||0,e=e||0;var o=void 0;return s(t,function(){o=t.getBoundingClientRect()}),{x:i-o.left,y:e-o.top}},i.extend=function t(){var i=void 0,e=void 0,r=void 0,n=void 0,a=void 0,s=arguments[0]||{},l=void 0===s?"undefined":o(s),h=Object.prototype.toString,c=1,u=arguments.length,_=!1;"boolean"===l&&(_=s,s=arguments[c]||{},l=void 0===s?"undefined":o(s),c++);"object"!==l&&"function"!==l&&(s={});c===u&&(s=this,c--);for(;c<u;c++)if(null!=(i=arguments[c]))for(e in i)r=s[e],n=i[e],s!==n&&(_&&n&&((a="[object Array]"===h.call(n))||"[object Object]"===h.call(n))?(a?(a=!1,r=r&&"[object Array]"===h.call(r)?r:[]):r=r&&"[object Object]"===h.call(r)?r:{},s[e]=t(_,r,n)):void 0!==n&&(s[e]=n));return s},i.proxy=function(t,i){if("string"==typeof i){var e=t[i];i=t,t=e}if("function"!=typeof t)return;var o=Array.prototype.slice,r=o.call(arguments,2),a=function(){return t.apply(i||this,r.concat(o.call(arguments)))};return a.guid=t.guid=t.guid||n++,a},i.hideAction=s,i.isPercent=function(t){return/%$/.test(t+"")},i.isNumber=l,i.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.toArray=h,i.createElement=function(t,i,e,r){var n=document.createElement("DIV");"object"===(void 0===i?"undefined":o(i))&&(r=i,i=null);"object"===(void 0===e?"undefined":o(e))&&(r=e,e=null);if("object"===(void 0===r?"undefined":o(r)))for(var a in r)n.style[a]=r[a];i&&(n.className=i);e&&(n.id=e);return t.appendChild(n),n},i.removeElement=function(t){t.parentNode&&t.parentNode.removeChild(t)},i.$=function(t,i){if(t instanceof HTMLElement)return[t];if("object"===(void 0===t?"undefined":o(t))&&t.length)return h(t);if(!t||"string"!=typeof t)return[];"string"==typeof i&&(i=document.querySelector(i));i instanceof HTMLElement||(i=document);return h(i.querySelectorAll(t))},i.attr=function(t,i,e){if("object"===(void 0===i?"undefined":o(i))){for(var r in i)t[r]=i[r];return t}return void 0===e?t[i]:(t[i]=e,t)},i.css=function(t,i,e){if("object"===(void 0===i?"undefined":o(i))){for(var r in i)l(e=i[r])&&(e+="px"),t.style[r]=e;return t}return void 0===e?window.getComputedStyle(t)[i]:(l(e)&&(e+="px"),t.style[i]=e,t)},i.support=function(t){var i=document.documentElement;if(t in i.style)return"";for(var e,o=t.charAt(0).toUpperCase()+t.substr(1),r=["Webkit","Moz","ms","O"],n=0;e=r[n++];)if(e+o in i.style)return"-"+e.toLowerCase()+"-"};var n=0;var a={};function s(t,i,e){"object"!==(void 0===t?"undefined":o(t))&&(t=[]),void 0===t.length&&(t=[t]);for(var r,n=[],s=[],l=0;r=t[l++];)for(;r instanceof HTMLElement;){var h=r.nodeName;if(!r.getClientRects().length){n.push(r),s.push(r.style.display);var c=a[h];if(!c){var u=document.createElement(h);document.body.appendChild(u),c=window.getComputedStyle(u).display,u.parentNode.removeChild(u),"none"===c&&(c="block"),a[h]=c}r.style.display=c}if("BODY"===h)break;r=r.parentNode}"function"==typeof i&&i.call(e||this);for(var _=n.length;_--;)n.pop().style.display=s.pop()}function l(t){return"number"==typeof t}function h(t){return Array.prototype.map.call(t,function(t){return t})}},function(i,e){i.exports=t},function(t,e){t.exports=i},function(t,i){t.exports=e},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(i,e,o){return e&&t(i.prototype,e),o&&t(i,o),i}}(),n=h(e(3)),a=h(e(2)),s=h(e(1)),l=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(e(0));function h(t){return t&&t.__esModule?t:{default:t}}var c=!!navigator.userAgent.match(/mobile/i),u=!!navigator.userAgent.match(/android/i),_=l.support("transition"),p=l.support("transform"),d=function(){},f={size:[100,100],adaptive:"",outputSize:[0,0],outputType:"jpg",outputQuality:.8,maxZoom:1,rotateFree:!u,view:"",file:"",ok:"",img:"",loadStart:d,loadComplete:d,loadError:d,done:d,fail:d,lrzOption:{width:u?1e3:void 0,height:u?1e3:void 0,quality:.7},style:{maskColor:"rgba(0,0,0,.5)",maskBorder:"2px dashed #ddd",jpgFillColor:"#fff"},errorMsg:{noSupport:"您的浏览器版本过于陈旧，无法支持裁图功能，请更换新的浏览器！",imgError:"不支持该图片格式，请选择常规格式的图片文件！",imgHandleError:"图片处理失败！请更换其它图片尝试。",imgLoadError:"图片读取失败！请更换其它图片尝试。",noImg:"没有可裁剪的图片！",clipError:"截图失败！当前图片源文件可能存在跨域问题，请确保图片与应用同源。如果您是在本地环境下执行本程序，请更换至服务器环境。"}},y=function(){function t(i,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),(i=l.$(i))&&i.length&&(this._$container=i[0],this._options=l.extend(!0,{},f,e),void 0===p&&this._options.errorMsg.noSupport&&alert(this._options.errorMsg.noSupport),this._init())}return r(t,[{key:"_init",value:function(){var t=this,i=this._options;l.isNumber(i.size)?i.size=[i.size,i.size]:l.isArray(i.size)?((!l.isNumber(i.size[0])||i.size[0]<=0)&&(i.size[0]=f.size[0]),(!l.isNumber(i.size[1])||i.size[1]<=0)&&(i.size[1]=f.size[1])):i.size=l.extend({},f.size),l.isNumber(i.outputSize)?i.outputSize=[i.outputSize,0]:l.isArray(i.outputSize)?((!l.isNumber(i.outputSize[0])||i.outputSize[0]<0)&&(i.outputSize[0]=f.outputSize[0]),(!l.isNumber(i.outputSize[1])||i.outputSize[1]<0)&&(i.outputSize[1]=f.outputSize[1])):i.outputSize=l.extend({},f.outputSize),"jpg"===i.outputType?i.outputType="image/jpeg":i.outputType="image/png",l.isArray(i.adaptive)&&(this._widthIsPercent=!(!i.adaptive[0]||!l.isPercent(i.adaptive[0]))&&i.adaptive[0],this._heightIsPercent=!(!i.adaptive[1]||!l.isPercent(i.adaptive[1]))&&i.adaptive[1]),this._outputWidth=i.outputSize[0],this._outputHeight=i.outputSize[1],this._canvas=document.createElement("canvas"),this._iScroll=null,this._hammerManager=null,this._clipWidth=0,this._clipHeight=0,this._clipSizeRatio=1,this._$img=null,this._imgLoaded=!1,this._containerWidth=0,this._containerHeight=0,this._$clipLayer=null,this._$moveLayer=null,this._$rotationLayer=null,this._viewList=null,this._fileList=null,this._okList=null,this._$mask=null,this._$mask_left=null,this._$mask_right=null,this._$mask_right=null,this._$mask_bottom=null,this._$clip_frame=null,this._atRotation=!1,this._rotationLayerWidth=0,this._rotationLayerHeight=0,this._rotationLayerX=0,this._rotationLayerY=0,this._rotationLayerOriginX=0,this._rotationLayerOriginY=0,this._curAngle=0,l.bind(this,"_rotateCW90","_fileOnChangeHandle","_clipImg","_resize","size","load","clear","rotate","scale","clip","destroy"),this._initElements(),this._initScroll(),this._initRotationEvent(),this._initFile(),this._resize(),window.addEventListener("resize",this._resize),(this._okList=l.$(i.ok))&&this._okList.forEach(function(i){i.addEventListener("click",t._clipImg)}),this._options.img&&this._lrzHandle(this._options.img)}},{key:"_initElements",value:function(){var t=this._$container,i=t.style,e={};e["user-select"]=i["user-select"],e.overflow=i.overflow,e.position=i.position,this._containerOriginStyle=e,l.css(t,{"user-select":"none",overflow:"hidden"}),"static"===l.css(t,"position")&&l.css(t,"position","relative"),this._$clipLayer=l.createElement(t,"photo-clip-layer",{position:"absolute",left:"50%",top:"50%"}),this._$moveLayer=l.createElement(this._$clipLayer,"photo-clip-move-layer"),this._$rotationLayer=l.createElement(this._$moveLayer,"photo-clip-rotation-layer");var o=this._$mask=l.createElement(t,"photo-clip-mask",{position:"absolute",left:0,top:0,width:"100%",height:"100%","pointer-events":"none"}),r=this._options,n=r.style.maskColor,a=r.style.maskBorder;if(this._$mask_left=l.createElement(o,"photo-clip-mask-left",{position:"absolute",left:0,right:"50%",top:"50%",bottom:"50%",width:"auto","background-color":n}),this._$mask_right=l.createElement(o,"photo-clip-mask-right",{position:"absolute",left:"50%",right:0,top:"50%",bottom:"50%","background-color":n}),this._$mask_top=l.createElement(o,"photo-clip-mask-top",{position:"absolute",left:0,right:0,top:0,bottom:"50%","background-color":n}),this._$mask_bottom=l.createElement(o,"photo-clip-mask-bottom",{position:"absolute",left:0,right:0,top:"50%",bottom:0,"background-color":n}),this._$clip_frame=l.createElement(o,"photo-clip-area",{border:a,position:"absolute",left:"50%",top:"50%"}),this._viewList=l.$(r.view),this._viewList){var s=[];this._viewList.forEach(function(t,i){var e=t.style,o={};o["background-repeat"]=e["background-repeat"],o["background-position"]=e["background-position"],o["background-size"]=e["background-size"],s[i]=o,l.css(t,{"background-repeat":"no-repeat","background-position":"center","background-size":"contain"})}),this._viewOriginStyleList=s}}},{key:"_initScroll",value:function(){this._iScroll=new a.default(this._$clipLayer,{zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,mouseWheel:!0,disablePointer:!0,disableTouch:!1,disableMouse:!1,wheelAction:"zoom",bounceTime:300})}},{key:"_refreshScroll",value:function(t){t=t||0;var i=this._iScroll.options,e=this._options.maxZoom,o=this._rotationLayerWidth,r=this._rotationLayerHeight;o&&r?(i.zoomMin=l.getScale(this._clipWidth,this._clipHeight,o,r),i.zoomMax=Math.max(e,i.zoomMin),i.startZoom=Math.min(i.zoomMax,l.getScale(this._containerWidth,this._containerHeight,o,r))):(i.zoomMin=1,i.zoomMax=e,i.startZoom=1),l.css(this._$moveLayer,{width:o,height:r}),this._$clipLayer.appendChild(this._$moveLayer),this._iScroll.refresh(t)}},{key:"_resetScroll",value:function(t,i){t=t||0,i=i||0,this._rotationLayerWidth=t,this._rotationLayerHeight=i,this._rotationLayerX=0,this._rotationLayerY=0,this._curAngle=0,g(this._$rotationLayer,this._rotationLayerX,this._rotationLayerY,this._curAngle),l.css(this._$rotationLayer,{width:t,height:i}),this._refreshScroll();var e=this._iScroll,o=e.scale,r=.5*(this._clipWidth-t*o),n=.5*(this._clipHeight-i*o);e.scrollTo(r,n),e.zoom(e.options.startZoom,void 0,void 0,0)}},{key:"_initRotationEvent",value:function(){var t=this;if(c){this._hammerManager=new n.default.Manager(this._$moveLayer),this._hammerManager.add(new n.default.Rotate);var i=this._options.rotateFree,e=this._iScroll.options.bounceTime,o=void 0,r=void 0,a=void 0;this._hammerManager.on("rotatestart",function(e){t._atRotation||(o=!0,i?(r=(e.rotation-t._curAngle)%360,t._rotationLayerRotateReady(e.center)):r=e.rotation)}),this._hammerManager.on("rotatemove",function(e){o&&(a=e.rotation-r,i&&t._rotationLayerRotate(a))}),this._hammerManager.on("rotateend rotatecancel",function(r){if(o){if(o=!1,!i)return(a%=360)>180?a-=360:a<-180&&(a+=360),void(a>30?t._rotateBy(90,e,r.center):a<-30&&t._rotateBy(-90,e,r.center));var n=a%360;n<0&&(n+=360),n<10?a+=-n:n>80&&n<100?a+=90-n:n>170&&n<190?a+=180-n:n>260&&n<280?a+=270-n:n>350&&(a+=360-n),t._rotationLayerRotateFinish(a,e)}})}else this._$moveLayer.addEventListener("dblclick",this._rotateCW90)}},{key:"_rotateCW90",value:function(t){this._rotateBy(90,this._iScroll.options.bounceTime,{x:t.clientX,y:t.clientY})}},{key:"_rotateBy",value:function(t,i,e){this._rotateTo(this._curAngle+t,i,e)}},{key:"_rotateTo",value:function(t,i,e){this._atRotation||(this._rotationLayerRotateReady(e),this._rotationLayerRotateFinish(t,i))}},{key:"_rotationLayerRotateReady",value:function(t){var i=this._iScroll.scale,e=void 0;(e=t?l.globalToLoacl(this._$rotationLayer,t.x,t.y):l.loaclToLoacl(this._$rotationLayer,this._$clipLayer,.5*this._clipWidth,.5*this._clipHeight)).x/=i,e.y/=i;var o={x:e.x-this._rotationLayerX,y:e.y-this._rotationLayerY},r=l.pointRotate(o,-this._curAngle);this._rotationLayerOriginX=r.x,this._rotationLayerOriginY=r.y;var n=this._$rotationLayer.getBoundingClientRect();m(this._$rotationLayer,this._rotationLayerOriginX,this._rotationLayerOriginY);var a=this._$rotationLayer.getBoundingClientRect();this._rotationLayerX+=(n.left-a.left)/i,this._rotationLayerY+=(n.top-a.top)/i,g(this._$rotationLayer,this._rotationLayerX,this._rotationLayerY,this._curAngle)}},{key:"_rotationLayerRotate",value:function(t){g(this._$rotationLayer,this._rotationLayerX,this._rotationLayerY,t),this._curAngle=t}},{key:"_rotationLayerRotateFinish",value:function(t,i){var e=this;g(this._$rotationLayer,this._rotationLayerX,this._rotationLayerY,t);var o=this._$rotationLayer.getBoundingClientRect();m(this._$rotationLayer,0,0);var r=this._$rotationLayer.getBoundingClientRect();g(this._$rotationLayer,this._rotationLayerX,this._rotationLayerY,0);var n=this._$rotationLayer.getBoundingClientRect(),a=this._$moveLayer.getBoundingClientRect(),s=this._iScroll,h=s.scale,c={x:o.left-a.left,y:o.top-a.top};this._rotationLayerWidth=o.width/h,this._rotationLayerHeight=o.height/h,this._rotationLayerX=(n.left-r.left)/h,this._rotationLayerY=(n.top-r.top)/h,s.scrollTo(s.x+c.x,s.y+c.y),this._refreshScroll(s.options.bounceTime);var u=Math.max(s.options.zoomMin,Math.min(s.options.zoomMax,h));u!==h&&(c.x=c.x/h*u,c.y=c.y/h*u),s.startX+=c.x,s.startY+=c.y,t!==this._curAngle&&i&&l.isNumber(i)&&void 0!==_?(c={x:(r.left-o.left)/h,y:(r.top-o.top)/h},m(this._$rotationLayer,this._rotationLayerOriginX,this._rotationLayerOriginY),g(this._$rotationLayer,this._rotationLayerX+c.x,this._rotationLayerY+c.y,this._curAngle),this._atRotation=!0,function(t,i,e,o,r,n){l.css(t,p+"transform"),l.css(t,p+"transition",p+"transform "+r+"ms cubic-bezier(0.1, 0.57, 0.1, 1)"),g(t,i,e,o),setTimeout(function(){l.css(t,p+"transition",""),n()},r)}(this._$rotationLayer,this._rotationLayerX+c.x,this._rotationLayerY+c.y,t,i,function(){e._atRotation=!1,e._rotateFinishUpdataElem(t)})):this._rotateFinishUpdataElem(t)}},{key:"_rotateFinishUpdataElem",value:function(t){m(this._$rotationLayer,this._rotationLayerOriginX=0,this._rotationLayerOriginY=0),g(this._$rotationLayer,this._rotationLayerX,this._rotationLayerY,this._curAngle=t%360)}},{key:"_initFile",value:function(){var t=this,i=this._options;(this._fileList=l.$(i.file))&&this._fileList.forEach(function(i){c||l.attr(i,"accept","image/jpeg, image/x-png, image/png, image/gif"),i.addEventListener("change",t._fileOnChangeHandle)})}},{key:"_fileOnChangeHandle",value:function(t){var i=t.target.files;i.length&&this._lrzHandle(i[0])}},{key:"_lrzHandle",value:function(t){var i=this,e=this._options,r=e.errorMsg;if("object"===(void 0===t?"undefined":o(t))&&t.type&&!/image\/\w+/.test(t.type))return e.loadError.call(this,r.imgError),!1;this._imgLoaded=!1,e.loadStart.call(this,t);try{(0,s.default)(t,e.lrzOption).then(function(t){i._clearImg(),i._createImg(t.base64)}).catch(function(t){e.loadError.call(i,r.imgHandleError,t)})}catch(t){throw e.loadError.call(this,r.imgHandleError,t),t}}},{key:"_clearImg",value:function(){this._$img&&(this._$img.onload=null,this._$img.onerror=null,l.removeElement(this._$img),this._$img=null,this._imgLoaded=!1)}},{key:"_createImg",value:function(t){var i=this,e=this._options,o=e.errorMsg;this._$img=new Image,l.css(this._$img,{"user-select":"none","pointer-events":"none"}),this._$img.onload=function(t){var o=t.target;i._imgLoaded=!0,e.loadComplete.call(i,o),i._$rotationLayer.appendChild(o),l.hideAction([o,i._$moveLayer],function(){i._resetScroll(o.naturalWidth,o.naturalHeight)})},this._$img.onerror=function(t){e.loadError.call(i,o.imgLoadError,t)},l.attr(this._$img,"src",t)}},{key:"_clipImg",value:function(){var t=this._options,i=t.errorMsg;if(this._imgLoaded){var e=l.loaclToLoacl(this._$rotationLayer,this._$clipLayer),o=this._iScroll.scale,r=this._canvas.getContext("2d"),n=1,a=1;this._outputWidth||this._outputHeight?(this._canvas.width=this._outputWidth,this._canvas.height=this._outputHeight,n=this._outputWidth/this._clipWidth*o,a=this._outputHeight/this._clipHeight*o):(this._canvas.width=this._clipWidth/o,this._canvas.height=this._clipHeight/o),r.clearRect(0,0,this._canvas.width,this._canvas.height),r.fillStyle=t.style.jpgFillColor,r.fillRect(0,0,this._canvas.width,this._canvas.height),r.save(),r.scale(n,a),r.translate(this._rotationLayerX-e.x/o,this._rotationLayerY-e.y/o),r.rotate(this._curAngle*Math.PI/180),r.drawImage(this._$img,0,0),r.restore();try{var s=this._canvas.toDataURL(t.outputType,t.outputQuality);return this._viewList&&this._viewList.forEach(function(t){l.css(t,"background-image","url("+s+")")}),t.done.call(this,s),s}catch(e){throw t.fail.call(this,i.clipError),e}}else t.fail.call(this,i.noImg)}},{key:"_resize",value:function(t,i){l.hideAction(this._$container,function(){this._containerWidth=this._$container.offsetWidth,this._containerHeight=this._$container.offsetHeight},this);var e=this._options.size,o=this._clipWidth,r=this._clipHeight;if(l.isNumber(t)&&(e[0]=t),l.isNumber(i)&&(e[1]=i),this._widthIsPercent||this._heightIsPercent){var n=e[0]/e[1];this._widthIsPercent&&(this._clipWidth=this._containerWidth/100*parseFloat(this._widthIsPercent),this._heightIsPercent||(this._clipHeight=this._clipWidth/n)),this._heightIsPercent&&(this._clipHeight=this._containerHeight/100*parseFloat(this._heightIsPercent),this._widthIsPercent||(this._clipWidth=this._clipHeight*n))}else this._clipWidth=e[0],this._clipHeight=e[1];var a=this._clipWidth,s=this._clipHeight;if(this._clipSizeRatio=a/s,this._outputWidth&&!this._outputHeight&&(this._outputHeight=this._outputWidth/this._clipSizeRatio),this._outputHeight&&!this._outputWidth&&(this._outputWidth=this._outputHeight*this._clipSizeRatio),l.css(this._$clipLayer,{width:a,height:s,"margin-left":-a/2,"margin-top":-s/2}),l.css(this._$mask_left,{"margin-right":a/2,"margin-top":-s/2,"margin-bottom":-s/2}),l.css(this._$mask_right,{"margin-left":a/2,"margin-top":-s/2,"margin-bottom":-s/2}),l.css(this._$mask_top,{"margin-bottom":s/2}),l.css(this._$mask_bottom,{"margin-top":s/2}),l.css(this._$clip_frame,{width:a,height:s}),l.css(this._$clip_frame,p+"transform","translate(-50%, -50%)"),a!==o||s!==r){this._refreshScroll();var h=this._iScroll,c=h.scale,u=.5*(a-o)*c,_=.5*(s-r)*c;h.scrollBy(u,_);var d=Math.max(h.options.zoomMin,Math.min(h.options.zoomMax,c));d!==c&&h.zoom(d,void 0,void 0,0)}}},{key:"size",value:function(t,i){return this._resize(t,i),this}},{key:"load",value:function(t){return this._lrzHandle(t),this}},{key:"clear",value:function(){return this._clearImg(),this._resetScroll(),this._fileList&&this._fileList.forEach(function(t){t.value=""}),this}},{key:"rotate",value:function(t,i){return void 0===t?this._curAngle:(this._rotateTo(t,i),this)}},{key:"scale",value:function(t,i){return void 0===t?this._iScroll.scale:(this._iScroll.zoom(t,void 0,void 0,i),this)}},{key:"clip",value:function(){return this._clipImg()}},{key:"destroy",value:function(){var t=this;window.removeEventListener("resize",this._resize),this._$container.removeChild(this._$clipLayer),this._$container.removeChild(this._$mask),l.css(this._$container,this._containerOriginStyle),this._iScroll&&this._iScroll.destroy(),this._hammerManager?(this._hammerManager.off("rotatemove"),this._hammerManager.off("rotateend"),this._hammerManager.destroy()):this._$moveLayer.removeEventListener("dblclick",this._rotateCW90),this._$img&&(this._$img.onload=null,this._$img.onerror=null),this._viewList&&this._viewList.forEach(function(i,e){l.css(i,t._viewOriginStyleList[e])}),this._fileList&&this._fileList.forEach(function(i){i.removeEventListener("change",t._fileOnChangeHandle),i.value=null}),this._okList&&this._okList.forEach(function(i){i.removeEventListener("click",t._clipImg)}),l.destroy(this)}}]),t}();function m(t,i,e){i=(i||0).toFixed(2),e=(e||0).toFixed(2),l.css(t,p+"transform-origin",i+"px "+e+"px")}function g(t,i,e,o){i=i.toFixed(2),e=e.toFixed(2),o=o.toFixed(2),l.css(t,p+"transform","translateZ(0) translate("+i+"px,"+e+"px) rotate("+o+"deg)")}i.default=y,t.exports=i.default}])});